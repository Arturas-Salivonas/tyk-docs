---
date: 2021-03-22T10:00:00Z
title: Integrating Tyk with OKTA using OpenID Connect Dynamic Client Registration
menu:
  main:
    parent: "Tyk Developer Portal"
weight: 2 
url: /tyk-developer-portal/okta-dcr
---

## Integrating Tyk with OKTA using OpenID Connect Dynamic Client Registration

In this guide we’ll walk you through a basic integration of Tyk with OKTA using the [OpenID Connect Dynamic Client Registration protocol](https://tools.ietf.org/html/rfc7591). Our current implementation provides support for the client credentials flow with support for JWT (JSON Web Tokens). To the developer it look as follows:

An API with its corresponding policy is created in Tyk. It’s also exposed on the developer portal.

A developer signs up and creates a client using the developer portal.
Tyk sends the Dynamic Client Registration call to your identity provider. The IDP replies with the client ID and secret.

Using the previous information, the developer (or your application) triggers a call to the token endpoint of the IDP.
The developer (or your application) triggers a call to Tyk, using the token that was generated by the IDP. Tyk validates this token using the JSON Web Key Sets (JWKS) provided by the IDP.

### Requirements

- OKTA account (a [trial account](https://www.okta.com/free-trial/) should be enough).
- Basic Tyk Setup (gateway + dashboard).

### Getting started with OKTA

First signup to OKTA, the initial screen will look as follows:

![Step 1](/docs/img/dcr/okta/step_1.png)

The first thing we’ll need for our integration is an API token from OKTA, [the OpenID specification also calls this an "Initial Access Token"](https://openid.net/specs/openid-connect-registration-1_0.html#Terminology) to differentiate it from other tokens that are used in this protocol. To create this token, click on the "API" button that’s part of the "Security" button on the navigation bar:

![Step 2](/docs/img/dcr/okta/step_2.png)

Once in the API section, select the "Tokens" tab and click on "Create Token". In this step you will have to enter a name for the token, for this guide we’re calling it "Tyk Integration":

![Step 3](/docs/img/dcr/okta/step_3.png)

After clicking on "Create Token" OKTA will provide the token. Keep it handy as we’ll use it for the Tyk configuration step.

The second step is to create a scope, navigate to the "Authorization servers" tab that’s also part of the API section. Click on "Add Scope", remember to tick the "Set as default scope" option:

![Step 4](/docs/img/dcr/okta/step_4.png)

### Setting up Tyk

Now we’re ready to setup Tyk, open the Tyk Dashboard and click on the "APIs" button under "System Management". Create a new API called "OKTA API":

![Step 5](/docs/img/dcr/okta/step_5.png)

After the first part of the API creation form was filled, click on "Configure API" and set the authentication settings as follows:

![Step 6](/docs/img/dcr/okta/step_6.png)

**Where to get the proper JWKS URL for your OKTA environment?**

*In the OKTA Dashboard, open the "API" section under "Security", take the base URL from the default Authorization Server and append the "/v1/keys" suffix, e.g. https://tyk-testing.okta.com/oauth2/default/v1/keys*

For the "Identity Source" field use `"sub"` and for "Policy Field Name" use `"pol"`.

Click "Save" and switch to the "Policies" button under "System Management". Once in this section, click on "Create a Policy" and call it "OKTA Policy", you may use the default values for this one. Remember to select the previously created "OKTA API" in the access rights section. You will also need to set an expiration setting for the keys.

After the policy is ready, switch back to the API settings and make sure that the API is using the appropriate policy:

![Step 7](/docs/img/dcr/okta/step_7.png)

Now we’re ready to add this API to the developer portal. Switch to the "Catalogue" section that’s linked under "Portal Management" on the navigation menu. Once in this section, click on "Add New API", set a name for it and select the newly created policy. For this guide we’re using "OKTA API" again:

![Step 8](/docs/img/dcr/okta/step_8.png)

Click "Save" and click on the recently created item again, switch to the "Settings" tab that’s next to "API Details". In "API Details" toggle the "Override global settings" option.

**Note:** Tyk lets you set global portal settings that apply to all portal-listed APIs, in this guide we assume you’re enabling and setting up DCR for a single API. In case you want to enable DCR for all the APIs, you should refer to the "Settings" button under "Portal Management", in the "API Access" tab you will be able to enter DCR settings as well.

Once the "Override global settings" option is toggled, scroll down to the DCR section in the bottom and enter the following settings:

![Step 9](/docs/img/dcr/okta/step_9.png)

**Providers:** Different providers might implement the standard in slightly different ways, Tyk provides a specific driver for each one. For IDPs that aren’t on the list use the "Other" option. For this guide, pick "OKTA".

**Grant Types:** OAuth 2.0 grant types that will be used by the client, see the [specification](https://openid.net/specs/openid-connect-registration-1_0.html#rfc.section.2) for more details. Set "Client Credentials".

**Token Endpoint Auth Method:** defines the way the client will authenticate against the token endpoint. Use "Client Secret - Post".

**Response Types:** OAuth 2.0 response types that will be used by the client. Set "Token".

**Identity Provider Host:** Base IDP URL, e.g. https://tyk-testing.okta.com/

**Client Registration Endpoint:** OpenID Connect client registration endpoint. The value we use is https://tyk-testing.okta.com/oauth2/v1/clients

This value is found in your well-known discovery document as `registration_endpoint`. The well-known location URL is typically https://tyk-testing.okta.com/.well-known/openid-configuration (replace "tyk-testing" with your org.).

**Initial Registration Access Token:** the token that’s used to register new clients, this was generated in the early steps of the guide.

**A note on grant types and response types in OKTA**

*It’s important to note that OKTA’s DCR endpoint supports a parameter called `"application_type"`, the application types aren’t standard across all IDPs, while the initial specification mentions `"native"` or `"web"` types, some IDPs implement their own. In the current implementation Tyk supports the usage of the `"service"` application type which is required to support the client credentials flow that’s described in this guide, this is set automatically when OKTA is set as the provider. In the future we may extend this to support additional types, you will find more information in the [official OKTA documentation](https://developer.okta.com/docs/reference/api/oauth-clients/#client-application-properties).*

### Testing the flow

Now that both Tyk and OKTA are ready we can try the complete flow. Click on the "Developers" button under "Portal Management", then click on "Add developer", enter some basic information here to create a developer user.
After the developer is created, open the portal, click on the "OAuth Clients" navigation bar button and follow the wizard:

![Step 10](/docs/img/dcr/okta/step_10.png)

After clicking on "Create first OAuth Client" we’ll see our previously created "OKTA API", select that one and click on "Save and continue". The following screen will require you to enter a client name. It’s possible to set redirect URLs if you also plan to use this client for other flow types. This setting can be left blank for the purposes of this guide.

![Step 11](/docs/img/dcr/okta/step_11.png)

Once you click on "Create", Tyk will trigger a registration on your IDP and the details of your client will show up:

![Step 12](/docs/img/dcr/okta/step_12.png)

If you check the OKTA dashboard you will see this client too:

![Step 13](/docs/img/dcr/okta/step_13.png)

The next step is to generate a token and use it for accessing our "OKTA API", let’s use Postman for this. You will need your token URL which it’s also present in the Well-Known URI of your organization.
For this guide we use https://[org].okta.com/oauth2/default/v1/token

Our Postman request should contain the following body, where `"client_id"` and `"client_secret"` are the credentials we got from the developer portal:

![Step 14](/docs/img/dcr/okta/step_14.png)

Note that we aren’t using any additional header for this request, the client credentials are enough. We’re also passing our previously created `"tyk"` scope as value.

Once we get a response from the IDP, we can copy the `"access_token"` and use it to access our "OKTA API", this request will be proxied by Tyk:

![Step 15](/docs/img/dcr/okta/step_15.png)
